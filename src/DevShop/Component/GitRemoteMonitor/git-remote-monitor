#!/usr/bin/env php
<?php
/**
 * @file git-remote-monitor
 * Executable file for the git-remote-monitor cli.
 *
 * The git-remote-monitor CLI is used by the git-remote-monitord daemon service
 * so that the functionality is contained in simple Symfony Console & Robo commands.
 */

global $classLoader;
require 'bootstrap.php';

$appName = "Git Remote Monitor";
$appVersion = trim(file_get_contents(__DIR__ . '/VERSION'));

// Customization variables
$argv = $_SERVER['argv'];

$commandClasses = [];
$commandClasses[] = \DevShop\Component\GitRemoteMonitor\Commands::class;

$selfUpdateRepository = 'devshop-packages/git-remote-monitor';
$configPrefix = 'GRM';
$configFilePath = getenv($configPrefix.'_CONFIG') ?: getenv(
  'HOME'
).'/.grm.yml';

// Define our Runner, and pass it the command classes we provide.
$runner = new \Robo\Runner($commandClasses);
$runner
->setSelfUpdateRepository($selfUpdateRepository)
->setConfigurationFilename($configFilePath)
->setEnvConfigPrefix($configPrefix)
->setClassLoader($classLoader);

// Execute the command and return the result.
$output = new \Symfony\Component\Console\Output\ConsoleOutput();
$statusCode = $runner->execute($argv, $appName, $appVersion, $output);
exit($statusCode);
