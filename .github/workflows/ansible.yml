name: Ansible

on: [push]

jobs:
  molecule:
    name: Molecule

    runs-on: ubuntu-latest

    strategy:
      matrix:
        MOLECULE_DISTRO:
          - centos7
          - centos6
          - ubuntu1804
          - ubuntu1604
          - debian10

    steps:
      - uses: actions/checkout@v1

      # Using Python 3.6 to match travis-ci default.
      # See https://docs.travis-ci.com/user/languages/python/#specifying-python-versions
      - name: Set up Python 3.6
        uses: actions/setup-python@v1
        with:
          python-version: 3.6

      - name: Install Ansible & Molecule
        run: |
          pip install molecule docker
          ansible --version
          molecule --version

      - name: Test with Molecule
        working-directory: ./roles/opendevshop.devmaster
        run: molecule test
        # @TODO: Figure out why `molecule test` command doesn't get past mysql: https://github.com/opendevshop/devshop/commit/993a48a91c6d57ccb64559c44d946b961ebf7734/checks?check_suite_id=330086957#step:5:172
        # continue-on-error: true